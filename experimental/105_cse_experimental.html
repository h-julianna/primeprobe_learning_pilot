<!DOCTYPE html>
<html>
    <head>
        <title>105_cse_experiment</title>
        <script src='jspsych/dist/jspsych.js'></script>
        <script src='jspsych/dist/plugin-html-keyboard-response.js'></script>
        <script src='jspsych/dist/plugin-html-button-response.js'></script>
        <script src='jspsych/dist/plugin-fullscreen.js'></script>
        <!-- <script src="mytrials.js"></script> -->
        <script src='jspsych/dist/plugin-html-slider-response.js'></script>
        <script src='jspsych/dist/plugin-survey-text.js'></script>
        <script src="jspsych/dist/plugin-survey-multi-choice.js"></script>
        <link href='jspsych/dist/jspsych.css' rel='stylesheet' type='text/css' />
        <link href='styles.css' rel='stylesheet' type='text/css' />
        <!-- <script src="jatos.js"></script> -->
    </head>
    <body></body>
    <script>
       /*const jsPsych = initJsPsych()
       /*const jsPsych = initJsPsych({
	      on_trial_start: function() {
		    console.log(jatos.version)
	      console.log(jatos.urlQueryParameters.petyko)

	      const jatosdebug = jatos.urlQueryParameters.debug
	        console.log(jatosdebug)

	      if(jatosdebug == 1){
		      probe_duration = 1;
		      prime_duration = 1;
		      feedback_duration = 1;
		      blank_duration = 1;
		      probe_stim_duration = 1;
		      debug = 1;
	      }
	      console.log(probe_duration)
	    },
	    on_finish: () => jatos.endStudy(jsPsych.data.get().csv())
      }) 
      */
    
      /*welcome message*/
      /*data handling and informed consent*/
      /*informed consent*/
      /*instructions*/
      /*practice trials*/




      const timeline = [];

       var subj_code; //a variable that later stores a random subject code
        function makeid(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        } //this function generates a random string of characters


var jsPsych = initJsPsych()
/*({
	on_finish: () => jatos.endStudy(jsPsych.data.get().json())
})

        subj_code = makeid(6); //generating a random subject code

        console.log(subj_code); //printing the subject code to the console

        jsPsych.data.addProperties({subj_code: subj_code}); //adding the subject code to the data object
       
        var version = jsPsych.randomization.sampleWithoutReplacement([1,2],1)[0]; //Ezzel tudjuk majd váltogatni szerintem a kondíciókat. Majd 5 lesz összesen, szóval, a 2-es helyére 5 jön. */
        
        
        //defining welcome message//
        var welcome = {
            type: jsPsychHtmlButtonResponse,
            stimulus: `
            <img src="Experimental material/University_logo.png" alt=University Logo" style="width: 300px; display: block; margin: auto;">
            <h2>Üdvözlünk a Metatudomány kutatócsoport vizsgálatában!</h2>
                <p>Egy tudományos kutatásban veszel részt, amelynek vezetője Bognár Miklós, az ELTE Affektív Pszichológia Tanszékének kutatója. 
                A kutatás célja megvizsgálni, hogy miként hatnak a büntetés által kiváltott negatív motivációs állapotok a kognitív kontrollra.</p>
                <h3>Részvétel</h3>
                <p>A kutatásban való részvétel teljesen önkéntes. A vizsgálatot bármikor indoklás nélkül megszakíthatod. Ha bármilyen kérdésed, észrevételed vagy problémád van a kutatással kapcsolatban, írj Bognár Miklósnak a <a href="mailto:bognar.miklos@ppk.elte.hu">bognar.miklos@ppk.elte.hu</a> címre.</p>`,
            choices: ['Tovább']
        };
       


        //data handling and informed consent//
        const data_handling = {   
            type: jsPsychHtmlButtonResponse,
            stimulus: `<h2 style="text-align: center;">Adatkezelési tájékoztató</h2>
            <p style="text-align: justify; max-width: 800px; margin: auto;">Szigorúan bizalmasan kezelünk minden olyan személyes információt, amit a kutatás keretén belül gyűjtünk össze. 
                A kutatás során nyert adatokat kóddal ellátva biztonságos számítógépeken tároljuk. A kutatás során nyert adatokat összegezzük. 
                Az ELTE PPK Affektív Pszichológia Tanszék Metatudomány Kutatócsoportja, mint adatkezelő, fenti személyes adataidat bizalmasan kezeli, más adatkezelőnek, adatfeldolgozónak nem adja át.
                E tényállás részleteit a <a href="http://metasciencelab.elte.hu/hozzajarulas-adatkezeleshez/" target=_blank">"Hozzájárulás adatkezeléshez"</a> c. dokumentum tartalmazza.</p>

            <p>Az adatkezelésről szóló szabályzásról részletesebben pedig itt tájékozódhatsz:
                <a href="https://ppk.elte.hu/file/Hozzajarulas_adatkezeleshez_melleklet_2018.pdf" target="_blank">Hozzájárulás adatkezeléshez melléklet</a></p>
            <p>A kutatás során nyert személyes adataidat arra használjuk fel, hogy regisztrálhassuk a részvételért járó kurzuspontokat. 
            Az azonosítására alkalmas adatokat (NEPTUN kód) ezután törölni fogjuk. A kezelt adatok a következők:</p>

                <ul>
                    <li>NEPTUN-kód</li>
                    <li>Életkor</li>
                    <li>Nem</li>
                    <li>Iskolai végzettség</li>
                </ul>
            <p>Válaszaid nem lesznek semmilyen módon hozzád köthetők. Az anonimizált adataidat más kutatókkal megosztjuk.</p>
            <p><strong>Kérlek, amennyiben egyetértesz a fenti feltételekkel, és hozzájárulsz a kutatásban való részvételhez, kattints az "Igen" gombra.</strong></p>`,
            choices: ['Igen', 'Nem'],
            response_ends_trial: true,
            on_finish: function(data) {
            if (data.response == 1) {
                jsPsych.abortExperiment('<p style="text-align: justify; max-width: 800px; margin: auto; font-size: 24px; font-weight: bold">A kísérlet véget ért. Köszönjük, hogy részt vettél a vizsgálatban!</p>');
            }
            }
        };
       

        //informed consent//
        const informed_consent = {
            type:jsPsychHtmlButtonResponse,
            stimulus: `<h2>Beleegyező nyilatkozat</h2>
                <p>Felelősségem teljes tudatában kijelentem, hogy a mai napon az Eötvös Loránd Tudományegyetem, Bognár Miklós kutatásvezető által végzett vizsgálatban</p>
                 <ul>
                    <li>önként veszek részt.</li>
                    <li>a vizsgálat jellegéről, annak megkezdése előtt kielégítő tájékoztatást kaptam.</li>
                    <li>nem szenvedek semmilyen pszichiátriai betegségben.</li>
                    <li>a vizsgálat idején alkohol vagy drogok hatása alatt nem állok.</li>
                 </ul>

                <p>Tudomásul veszem, hogy az azonosításomra alkalmas személyi adataimat bizalmasan kezelik.
                    Hozzájárulok ahhoz, hogy a vizsgálat során a rólam felvett, személyem azonosítására nem alkalmas adatok más kutatók számára is hozzáférhetők legyenek.
                    Fenntartom a jogot arra, hogy a vizsgálat során annak folytatásától bármikor elállhassak. 
                    Ilyen esetben a rólam addig felvett adatokat törölni kell.</p>
.
                <p>Tudomásul veszem, hogy csak a teljesen befejezett kitöltésért kapok pontot a <em>Pszichológiai kísérletben és tudományos aktivitásban való részvétel</em> nevű kurzuson.</p>

                <p><strong>A kutatásban való részvételem körülményeiről részletes tájékoztatást kaptam, a feltételekkel egyetértek. 
                    Amennyiben egyetértesz a fenti feltételekkel, kattints az "Igen" gombra.</strong></p>`,
            choices: ['Igen', 'Nem'],
            response_ends_trial: true,
            on_finish: function(data) {
                //console.log(blockset[0][0].prime);
            if (data.response == 1) {
                jsPsych.abortExperiment('<p style="text-align: justify; max-width: 800px; margin: auto; font-size: 24px; font-weight: bold">A kísérlet véget ért. Köszönjük, hogy részt vettél a vizsgálatban!</p>');
            }
            }
                        };


const practice_instructions = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `<h2>Gyakorló blokk</h2>
            <p>A kísérlet megkezdése előtt egy rövid gyakorló blokk következik. Ebben a blokkban nem vonunk le garast a hibás válaszokért, azonban törekedj a minél gyorsabb és pontosabb válaszadásra! 
            Ha készen állsz, nyomj meg egy tetszőleges billentyűt a kezdéshez.</p>`
}

const practice_intermission = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p style="text-align: center; max-width: 800px; margin: auto; font-size: 24px"> Még egy rövid gyakorló blokk következik.
        Ha készen állsz, nyomj meg egy tetszőleges billentyűt a kezdéshez. TÖREKEDJ RÁ TÖREKEDJ PRÓBÁLD</p>`,
    choices: "ALL_KEYS",
}

const practice_end = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p style="text-align: center; max-width: 800px; margin: auto; font-size: 24px">A gyakorló rész véget ért, a kísérleti blokkok következnek.
        Ha készen állsz, nyomj meg egy tetszőleges billentyűt a kezdéshez.</p>`,
    choices: "ALL_KEYS",
}
      //Demographic informations

var education = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: "<strong>Mi a legmagasabb iskolai végzettséged?</strong>",
      name: "education",
      options: ["Általános iskola", "Szakközépiskola", "Szakgimnázium", "Gimnázium", "Főiskola", "Egyetem, alapképzés", "Egyetem, mesterképzés", "Doktori képzés"],
      required: true,
      },
      {
          prompt: "<strong>Melyik a nemmel azonosulsz?</strong>",
          name: "gender",
          options: ["Férfi", "Nő", "Nem-bináris", "Nem szeretném megosztani"],
          required: true
      }
  ],
  button_label: "Tovább"
};

var age_neptun = {
type: jsPsychSurveyText,
questions: [
  {prompt: "Hány éves vagy?", name: "age", required: true},
  {prompt: "Mi a NEPTUN kódod?", name: "neptun", required: true}
],
button_label: "Tovább"
};

var demographic_timeline = [age_neptun, education]
 console.log(demographic_timeline)



        //instructions//
        const instructions = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `<h2>Instrukciók</h2>
                <p>Ebben a kísérletben arra vagyunk kíváncsiak, hogy miként befolyásolja a büntetés a konfliktusfeldolgozást. 
                A kísérlet során iránymegjelöléseket fogsz olvasni (FEL, LE, JOBB, BAL). Először egy prime inger fog megjelenni a képernyőn, amin egy irány (pl.: „FEL”) lesz olvasható egymás alatt háromszor. 
                Ezt követően megjelenik a célinger, ami vagy azonos („FEL”) vagy ellentétes („LE”) lesz az előtte bemutatott iránnyal.
                A feladatod az lesz, hogy minél gyorsabban és pontosabban eltaláld a célinger irányát a hozzárendelt billentyű megnyomásával.</p> 
                <p>Kérlek helyezd a billentyűzetre a kezedet a képen látható módon:</p>
                <p>A bal középső ujjadat tedd az „a”-ra, ez lesz  a "BAL" irány. A mutató ujjadat a „d”-re, ez fogja jelölni a "JOBB" irányt.
                    A jobb mutató ujjadat helyezd az „n”-re, ez lesz a "LE" irány. Míg a jobb középső ujjadat pedig tedd az „i”-re, ami a "FEL" irányt fogja jelölni!</p>
                <img src="Experimental material/instruction_pic.png" alt="Hand placemante instructions" style="width: 40%; height: 40%;">
                <p style="text-align: center;"><em>Amennyiben készen állsz a kísérlet megkezdésére, nyomd meg a space billentyűt!</em></p>`,
            choices: [" "],
        };
    
 const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        
            const probe_duration = 1000;
            const prime_duration = 133;
            const blank_duration = 33;
            const probe_stim_duration = 133;
	         const debug = 0;
         
   const stimulus = [
     {
        prime: '<span style="font-size: 35px;">le<br>le<br>le</span>',
        probe: '<span style="font-size: 35px;">fel</span>',
        congruency: 'incongruent',
        correct_response: 'i',
        name: 'stimulus'
     },
     {  
        prime: '<span style="font-size: 35px;">fel<br>fel<br>fel</span>',
        probe: '<span style="font-size: 35px;">le</span>',
        congruency: 'incongruent',
        correct_response: 'n',
        name: 'stimulus'

     },
     {
        prime: '<span style="font-size: 35px;">le<br>le<br>le</span>',
        probe: '<span style="font-size: 35px;">le</span>',
        congruency: 'congruent',
        correct_response: 'n',
        name: 'stimulus'
     },
     {
        
        prime: '<span style="font-size: 35px;">fel<br>fel<br>fel</span>',
        probe: '<span style="font-size: 35px;">fel</span>',
        congruency: 'congruent',
        correct_response: 'i',
        name: 'stimulus'
     },
     {
         
        prime: '<span style="font-size: 35px;">bal<br>bal<br>bal</span>',
        probe: '<span style="font-size: 35px;">jobb</span>',
        congruency: 'incongruent',
        correct_response: 'd',
        name: 'stimulus'
     },
     {
        prime: '<span style="font-size: 35px;">jobb<br>jobb<br>jobb</span>',
        probe: '<span style="font-size: 35px;">bal</span>',
        congruency: 'incongruent',
        correct_response: 'a',
        name: 'stimulus'
     },
     {
        prime: '<span style="font-size: 35px;">bal<br>bal<br>bal</span>',
        probe: '<span style="font-size: 35px;">bal</span>',
        congruency: 'congruent',
        correct_response: 'a',
        name: 'stimulus'
     },
     {
        prime: '<span style="font-size: 35px;">jobb<br>jobb<br>jobb</span>',
        probe: '<span style="font-size: 35px;">jobb</span>',
        congruency: 'congruent',
        correct_response: 'd',
        name: 'stimulus'
     }
    ]

    const red_stimulus = [
     {
        prime: '<span style="font-size: 35px;">le<br>le<br>le</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">fel</span>',
        congruency: 'incongruent',
        correct_response: 'i',
        name: 'red_stimulus'
     },
     {  
        prime: '<span style="font-size: 35px;">fel<br>fel<br>fel</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">le</span>',
        congruency: 'incongruent',
        correct_response: 'n',
        name: 'red_stimulus'

     },
     {
        prime: '<span style="font-size: 35px;">le<br>le<br>le</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">le</span>',
        congruency: 'congruent',
        correct_response: 'n',
        name: 'red_stimulus'
     },
     {
        
        prime: '<span style="font-size: 35px;">fel<br>fel<br>fel</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">fel</span>',
        congruency: 'congruent',
        correct_response: 'i',
        name: 'red_stimulus'
     },
     {
         
        prime: '<span style="font-size: 35px;">bal<br>bal<br>bal</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">jobb</span>',
        congruency: 'incongruent',
        correct_response: 'd',
        name: 'red_stimulus'
     },
     {
        prime: '<span style="font-size: 35px;">jobb<br>jobb<br>jobb</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">bal</span>',
        congruency: 'incongruent',
        correct_response: 'a',
        name: 'red_stimulus'
     },
     {
        prime: '<span style="font-size: 35px;">bal<br>bal<br>bal</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">bal</span>',
        congruency: 'congruent',
        correct_response: 'a',
        name: 'red_stimulus'
     },
     {
        prime: '<span style="font-size: 35px;">jobb<br>jobb<br>jobb</span>',
        probe: '<span style="font-size: 35px; color: #e60602;">jobb</span>',
        congruency: 'congruent',
        correct_response: 'd',
        name: 'red_stimulus'
     }
    ]


//Fixation//
   const fixation = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: "NO_KEYS",
    trial_duration: Math.random() * (600 - 400) + 400,
    /*trial_duration: function() {
        if (debug == 1){
            return 1;
        }else{
            return Math.random() * (600 - 400) + 400;
        }
    },*/
    data: {
        task: 'fixation'
    }
}

//Prime//
   const prime_trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: jsPsych.timelineVariable('prime'),
    choices: "NO_KEYS",
	trial_duration: prime_duration,
   function(){return prime_duration},
    data:{
        task:"prime"
    }
}

//Blank//
   const blank = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: ' ',
    choices: "NO_KEYS",
	trial_duration: blank_duration,
   function(){return blank_duration},
    data:{
        task:"blank"
    }
}
//Probe//
const probe_trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: jsPsych.timelineVariable('probe'),
    choices: ["a", "i", "d", "n"],
    stimulus_duration: function() {
        console.log("stimdur:", probe_stim_duration);
        return probe_stim_duration; 
    },
    trial_duration: probe_duration, 
    response_ends_trial: false,   
    data: {
        correct_response: jsPsych.timelineVariable('correct_response'),
        task: "probe",
        congruency: jsPsych.timelineVariable('congruency'),
        name: jsPsych.timelineVariable('name')
    },
    on_finish: function(data) {
        console.log("Response data:", data);
        console.log("Key pressed:", data.response);
        data.correct = data.response === data.correct_response;
    }
};
 
      
   //Trial sequence//
const block_neutral = {
  timeline: [fixation, prime_trial, blank, probe_trial],
  timeline_variables: stimulus
}

const block_red = {
  timeline: [fixation, prime_trial, blank, probe_trial],
  timeline_variables: red_stimulus
}
const trials = {
  timeline: [block_neutral, block_red]
}

const trial_sequence = {
  timeline: [fixation, prime_trial, blank, probe_trial],
  timeline_variables: (stimulus).concat(red_stimulus),
  randomize_order: true,
  repetitions: 2
}

const practice_block = {
    timeline: [fixation, prime_trial, blank, probe_trial],
    timeline_variables: (stimulus).concat(red_stimulus),
    randomize_order: true,
    repetitions: 2/*, (kikommenteltem h ne fusson örökké ikszdé)
    loop_function: function(data) {
	if(debug == 0){
        console.log(data);
        var correct_trials = data.filter({task: "probe",correct: true}).count();
        console.log(correct_trials);
        var total_trials = data.filter({task: "probe"}).count();
        
        if (total_trials > 0) {
            var accuracy = (correct_trials / total_trials) * 100;
            console.log("Accuracy:", accuracy + "%");
            if (accuracy >= 80) {
                return false;
            } else {
                return true;
            }
          
        }
    }else{
	return false;
    }
    } */
};

/*function shuffle_all_sessions() {
        const experimental_array =  [block_neutral, block_red];
        const shuffledArray = experimental_array.sort((a, b) => 0.5 - Math.random());
        console.log(shuffledArray);
        return shuffledArray;
        }

const experimental_blocks = {
  timeline: shuffle_all_sessions() 
}*/


const all_practice = {
    timeline: [practice_instructions, practice_block, practice_intermission, practice_block, practice_end]
  }

   timeline.push(welcome,data_handling,informed_consent, demographic_timeline, instructions, all_practice, trial_sequence);
   jsPsych.run(timeline) 
    </script>
</html>